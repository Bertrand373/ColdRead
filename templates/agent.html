<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Coachd</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#F5F5F7">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #F5F5F7;
            --color-glass: rgba(255,255,255,0.65);
            --color-glass-strong: rgba(255,255,255,0.85);
            --color-glass-border: rgba(255,255,255,0.4);
            --color-border: rgba(0,0,0,0.06);
            --color-text: #1A1A1A;
            --color-text-secondary: #6B7280;
            --color-text-muted: #9CA3AF;
            --color-accent: #3B82F6;
            --color-accent-soft: rgba(59,130,246,0.12);
            --color-error: #EF4444;
            --font-display: 'Outfit', sans-serif;
            --font-body: 'Inter', sans-serif;
            --blur: blur(24px);
            --blur-strong: blur(40px);
            --shadow-glass: 0 8px 32px rgba(0,0,0,0.06);
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-full: 9999px;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --sidebar-width: 72px;
        }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html, body { height:100%; overflow:hidden; }
        body { background:var(--color-bg); color:var(--color-text); font-family:var(--font-body); -webkit-font-smoothing:antialiased; }
        
        .screen { display:none; min-height:100%; }
        .screen.active { display:flex; }
        
        /* Code Screen */
        .code-screen { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px 24px; }
        .code-screen img { margin-bottom:16px; }
        .code-screen p { font-size:1.1rem; color:var(--color-text-secondary); margin-bottom:48px; }
        .code-input { width:100%; max-width:300px; padding:18px 24px; background:var(--color-glass-strong); backdrop-filter:var(--blur); border:1px solid var(--color-glass-border); border-radius:var(--radius-md); font-family:var(--font-body); font-size:1rem; font-weight:500; text-align:center; text-transform:uppercase; letter-spacing:0.15em; color:var(--color-text); margin-bottom:32px; box-shadow:var(--shadow-glass); }
        .code-input:focus { outline:none; border-color:var(--color-accent); }
        .code-input.error { border-color:var(--color-error); animation:shake 0.4s; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
        .code-error { display:none; color:var(--color-error); font-size:0.875rem; margin-top:-20px; margin-bottom:20px; }
        .code-error.visible { display:block; }
        .btn-primary { display:inline-flex; align-items:center; gap:10px; padding:16px 40px; background:var(--color-text); color:white; font-family:var(--font-display); font-size:0.95rem; font-weight:600; border:none; border-radius:var(--radius-md); cursor:pointer; }
        .btn-primary:hover { transform:translateY(-1px); }
        .btn-primary svg { width:18px; height:18px; }
        
        /* App Layout */
        .app-wrapper { display:flex; height:100%; }
        
        /* Sidebar (Desktop) */
        .sidebar { width:var(--sidebar-width); background:var(--color-glass); backdrop-filter:var(--blur-strong); border-right:1px solid var(--color-border); display:flex; flex-direction:column; align-items:center; padding:20px 0; position:fixed; top:0; left:0; height:100vh; z-index:100; }
        .sidebar-logo { width:40px; height:40px; margin-bottom:32px; }
        .sidebar-logo img { width:100%; height:100%; }
        .sidebar-nav { flex:1; display:flex; flex-direction:column; align-items:center; gap:8px; padding:0 12px; }
        .nav-item { width:48px; height:48px; display:flex; align-items:center; justify-content:center; border:none; border-radius:var(--radius-sm); background:transparent; color:var(--color-text-muted); cursor:pointer; transition:all 0.15s; text-decoration:none; position:relative; }
        .nav-item:hover { background:rgba(255,255,255,0.5); color:var(--color-text); }
        .nav-item.active { background:var(--color-accent-soft); color:var(--color-accent); }
        .nav-item svg { width:22px; height:22px; }
        .nav-item::after { content:attr(data-tooltip); position:absolute; left:calc(100% + 12px); padding:8px 12px; background:var(--color-text); color:white; font-size:0.8rem; font-weight:500; border-radius:8px; white-space:nowrap; opacity:0; visibility:hidden; transition:all 0.15s; pointer-events:none; }
        .nav-item:hover::after { opacity:1; visibility:visible; }
        .sidebar-footer { padding:0 12px; }
        .user-avatar { width:40px; height:40px; border-radius:50%; background:var(--color-accent-soft); color:var(--color-accent); display:flex; align-items:center; justify-content:center; font-weight:600; font-size:0.85rem; }
        
        /* Main Content */
        .main-content { flex:1; margin-left:var(--sidebar-width); height:100vh; overflow-y:auto; padding:32px 40px 120px; }
        .dashboard { max-width:1200px; margin:0 auto; }
        
        /* Header */
        .page-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:32px; }
        .page-title { font-family:var(--font-display); font-size:2rem; font-weight:600; letter-spacing:-0.02em; margin-bottom:4px; }
        .page-subtitle { font-size:0.95rem; color:var(--color-text-secondary); }
        .day-badge { display:flex; align-items:center; gap:8px; padding:10px 18px; background:var(--color-glass-strong); backdrop-filter:var(--blur); border:1px solid var(--color-glass-border); border-radius:var(--radius-full); font-size:0.85rem; font-weight:600; color:var(--color-accent); box-shadow:var(--shadow-glass); }
        .day-badge svg { width:16px; height:16px; }
        
        /* Glass Cards */
        .glass-card { background:var(--color-glass); backdrop-filter:var(--blur); border:1px solid var(--color-glass-border); border-radius:var(--radius-lg); box-shadow:var(--shadow-glass); overflow:hidden; }
        
        /* Progress Grid */
        .progress-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; margin-bottom:28px; }
        .progress-card { padding:24px; }
        .progress-card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
        .progress-label { font-size:0.9rem; font-weight:500; color:var(--color-text-secondary); }
        .progress-icon { width:36px; height:36px; border-radius:var(--radius-sm); background:rgba(255,255,255,0.5); display:flex; align-items:center; justify-content:center; color:var(--color-text-muted); }
        .progress-icon svg { width:18px; height:18px; }
        .progress-value { margin-bottom:16px; }
        .progress-current { font-family:var(--font-display); font-size:2.5rem; font-weight:600; line-height:1; }
        .progress-total { font-size:1.25rem; color:var(--color-text-muted); }
        .progress-track { height:6px; background:var(--color-border); border-radius:3px; overflow:hidden; }
        .progress-bar { height:100%; border-radius:3px; background:var(--color-accent); transition:width 0.5s; }
        
        /* Content Grid */
        .content-grid { display:grid; grid-template-columns:1.3fr 1fr; gap:20px; margin-bottom:28px; }
        .card-header { display:flex; justify-content:space-between; align-items:center; padding:20px 24px; border-bottom:1px solid var(--color-border); }
        .card-title { font-family:var(--font-display); font-size:1.1rem; font-weight:600; }
        .time-badge { display:flex; align-items:center; gap:6px; font-size:0.8rem; color:var(--color-text-muted); }
        .time-badge svg { width:14px; height:14px; }
        
        /* Schedule */
        .schedule-list { padding:16px; }
        .schedule-item { display:flex; align-items:center; gap:16px; padding:16px; border-radius:var(--radius-md); margin-bottom:8px; }
        .schedule-item:last-child { margin-bottom:0; }
        .schedule-item.active { background:var(--color-accent-soft); }
        .schedule-icon { width:48px; height:48px; min-width:48px; border-radius:var(--radius-md); background:rgba(255,255,255,0.5); display:flex; align-items:center; justify-content:center; color:var(--color-text-muted); }
        .schedule-icon svg { width:22px; height:22px; }
        .schedule-item.active .schedule-icon { background:var(--color-accent); color:white; }
        .schedule-content { flex:1; }
        .schedule-time { font-size:0.7rem; font-weight:600; color:var(--color-text-muted); text-transform:uppercase; letter-spacing:0.04em; }
        .schedule-title { font-family:var(--font-display); font-size:1rem; font-weight:600; }
        .schedule-item.active .schedule-title { color:var(--color-accent); }
        .schedule-desc { font-size:0.85rem; color:var(--color-text-secondary); }
        .schedule-action { padding:10px 18px; background:var(--color-accent); color:white; border:none; border-radius:var(--radius-sm); font-size:0.85rem; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px; }
        .schedule-action:hover { background:#2563EB; }
        .schedule-action svg { width:16px; height:16px; }
        
        /* Quick Access */
        .ask-container { padding:24px; }
        .ask-suggestions { display:flex; flex-wrap:wrap; gap:8px; }
        .suggestion-chip { padding:10px 16px; background:rgba(255,255,255,0.5); border:1px solid var(--color-border); border-radius:var(--radius-full); font-family:var(--font-body); font-size:0.85rem; font-weight:500; color:var(--color-text-secondary); cursor:pointer; transition:all 0.15s; }
        .suggestion-chip:hover { border-color:var(--color-accent); color:var(--color-accent); }
        
        /* Floating Search */
        .floating-search { position:fixed; bottom:32px; left:50%; transform:translateX(-50%); width:calc(100% - 80px - var(--sidebar-width)); max-width:700px; margin-left:calc(var(--sidebar-width)/2); z-index:200; }
        .search-bar { display:flex; align-items:center; gap:16px; padding:8px 8px 8px 24px; background:var(--color-glass-strong); backdrop-filter:var(--blur-strong); border:1px solid var(--color-glass-border); border-radius:var(--radius-full); box-shadow:0 12px 40px rgba(0,0,0,0.08), var(--shadow-glass); }
        .search-icon { color:var(--color-text-muted); }
        .search-icon svg { width:20px; height:20px; }
        .search-input { flex:1; border:none; background:transparent; font-family:var(--font-body); font-size:1rem; color:var(--color-text); outline:none; }
        .search-input::placeholder { color:var(--color-text-muted); }
        .search-btn { width:48px; height:48px; border:none; border-radius:50%; background:var(--color-text); color:white; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.15s; }
        .search-btn:hover { background:#000; transform:scale(1.05); }
        .search-btn svg { width:20px; height:20px; }
        
        /* Bottom Nav (Mobile) */
        .bottom-nav { display:none; position:fixed; bottom:0; left:0; right:0; background:var(--color-glass-strong); backdrop-filter:var(--blur-strong); border-top:1px solid var(--color-border); padding:8px 16px calc(8px + var(--safe-bottom)); z-index:300; }
        .bottom-nav-items { display:flex; justify-content:space-around; }
        .bottom-nav-item { display:flex; flex-direction:column; align-items:center; gap:4px; padding:8px 12px; background:transparent; border:none; color:var(--color-text-muted); text-decoration:none; }
        .bottom-nav-item.active { color:var(--color-accent); }
        .bottom-nav-item svg { width:24px; height:24px; }
        .bottom-nav-label { font-size:0.65rem; font-weight:500; }
        
        /* Toast & Loader */
        .toast { position:fixed; bottom:100px; left:50%; transform:translateX(-50%) translateY(100px); padding:14px 28px; background:var(--color-text); color:white; border-radius:var(--radius-full); font-size:0.9rem; font-weight:500; opacity:0; transition:all 0.3s; z-index:1000; }
        .toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
        .toast.error { background:var(--color-error); }
        .page-loader { position:fixed; inset:0; background:var(--color-bg); display:flex; align-items:center; justify-content:center; z-index:10000; transition:opacity 0.3s, visibility 0.3s; }
        .page-loader.hidden { opacity:0; visibility:hidden; }
        .loader-spinner { width:40px; height:40px; border:3px solid var(--color-border); border-top-color:var(--color-accent); border-radius:50%; animation:spin 0.8s linear infinite; }
        @keyframes spin { to { transform:rotate(360deg); } }
        
        /* Responsive */
        @media (max-width:1024px) { .progress-grid{grid-template-columns:repeat(2,1fr)} .content-grid{grid-template-columns:1fr} }
        @media (max-width:768px) {
            .sidebar { display:none; }
            .bottom-nav { display:block; }
            .main-content { margin-left:0; padding:24px 20px calc(160px + var(--safe-bottom)); }
            .page-header { flex-direction:column; gap:16px; }
            .page-title { font-size:1.6rem; }
            .progress-grid { grid-template-columns:1fr; gap:16px; }
            .floating-search { width:calc(100% - 40px); margin-left:0; bottom:calc(80px + var(--safe-bottom)); }
            .search-bar { padding:6px 6px 6px 20px; }
            .search-btn { width:44px; height:44px; }
        }
        @media (orientation:landscape) and (max-height:500px) { .app-wrapper{display:none!important} }
    </style>
</head>
<body>
    <!-- Code Screen -->
    <div class="screen active" id="codeScreen">
        <div class="code-screen">
            <img src="/static/logo.png" alt="Coachd" height="52">
            <p>Coaching on call.</p>
            <input type="text" class="code-input" id="agencyCode" placeholder="AGENCY CODE" autocomplete="off" autocapitalize="characters">
            <p class="code-error" id="codeError">Invalid agency code.</p>
            <button class="btn-primary" onclick="validateAgencyCode()">Continue <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="screen app-wrapper" id="dashboardScreen">
        <aside class="sidebar">
            <div class="sidebar-logo"><img src="/static/favicon.svg" alt=""></div>
            <nav class="sidebar-nav">
                <a href="/" class="nav-item active" data-tooltip="Dashboard"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></a>
                <a href="/call" class="nav-item" data-tooltip="Live Call"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></a>
                <a href="/chat" class="nav-item" data-tooltip="Chat"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></a>
                <a href="#" class="nav-item" data-tooltip="Resources"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg></a>
            </nav>
            <div class="sidebar-footer">
                <a href="#" class="nav-item" data-tooltip="Settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg></a>
                <div class="user-avatar" id="userAvatar">A</div>
            </div>
        </aside>

        <main class="main-content">
            <div class="dashboard">
                <header class="page-header">
                    <div>
                        <h1 class="page-title" id="greeting">Good morning, Agent</h1>
                        <p class="page-subtitle">Week 1 · Focus on training & observation</p>
                    </div>
                    <div class="day-badge">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
                        <span id="dayBadge">Day 4 of 14</span>
                    </div>
                </header>

                <section class="progress-grid">
                    <div class="glass-card progress-card">
                        <div class="progress-card-header">
                            <span class="progress-label">Modules</span>
                            <div class="progress-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg></div>
                        </div>
                        <div class="progress-value"><span class="progress-current">3</span><span class="progress-total">/5</span></div>
                        <div class="progress-track"><div class="progress-bar" style="width:60%"></div></div>
                    </div>
                    <div class="glass-card progress-card">
                        <div class="progress-card-header">
                            <span class="progress-label">Calls Today</span>
                            <div class="progress-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></div>
                        </div>
                        <div class="progress-value"><span class="progress-current">8</span><span class="progress-total">/15</span></div>
                        <div class="progress-track"><div class="progress-bar" style="width:53%"></div></div>
                    </div>
                    <div class="glass-card progress-card">
                        <div class="progress-card-header">
                            <span class="progress-label">Appointments</span>
                            <div class="progress-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div>
                        </div>
                        <div class="progress-value"><span class="progress-current">1</span><span class="progress-total">/3</span></div>
                        <div class="progress-track"><div class="progress-bar" style="width:33%"></div></div>
                    </div>
                </section>

                <div class="content-grid">
                    <section class="glass-card">
                        <div class="card-header">
                            <h2 class="card-title">Today's Schedule</h2>
                            <div class="time-badge"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg><span id="currentTime">--:--</span></div>
                        </div>
                        <div class="schedule-list" id="scheduleList"></div>
                    </section>
                    <section class="glass-card">
                        <div class="card-header"><h2 class="card-title">Quick Access</h2></div>
                        <div class="ask-container">
                            <div class="ask-suggestions">
                                <button class="suggestion-chip" onclick="goToChat('Down-close sequence')">Down-close sequence</button>
                                <button class="suggestion-chip" onclick="goToChat('Handle think about it')">Handle "think about it"</button>
                                <button class="suggestion-chip" onclick="goToChat('F.O.R.M. technique')">F.O.R.M. technique</button>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>

        <div class="floating-search">
            <div class="search-bar">
                <div class="search-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg></div>
                <input type="text" class="search-input" id="searchInput" placeholder="Ask Coachd anything...">
                <button class="search-btn" onclick="handleSearch()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="bottom-nav-items">
                <a href="/" class="bottom-nav-item active"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg><span class="bottom-nav-label">Home</span></a>
                <a href="/call" class="bottom-nav-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg><span class="bottom-nav-label">Call</span></a>
                <a href="/chat" class="bottom-nav-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg><span class="bottom-nav-label">Chat</span></a>
                <a href="#" class="bottom-nav-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg><span class="bottom-nav-label">Resources</span></a>
                <a href="#" class="bottom-nav-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg><span class="bottom-nav-label">Settings</span></a>
            </div>
        </nav>
    </div>

    <div class="toast" id="toast"></div>
    <div class="page-loader" id="pageLoader"><div class="loader-spinner"></div></div>

    <script>
        let currentAgency = null;
        const schedule = [
            { time: '11 AM – 1 PM', title: 'Training Block', desc: 'Complete TopNotch Module 4', icon: 'book', hours: [11, 13] },
            { time: '1 – 3 PM', title: 'Lunch / Flex', desc: 'Break or ExamFX study', icon: 'coffee', hours: [13, 15] },
            { time: '3 – 4 PM', title: 'Observation', desc: 'Join Advanced Training VC', icon: 'users', hours: [15, 16] },
            { time: '4 – 7 PM', title: 'Calling Block', desc: 'Goal: 15 dials, 3 appointments', icon: 'phone', hours: [16, 19] }
        ];
        const icons = {
            book: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>',
            coffee: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8h1a4 4 0 010 8h-1"/><path d="M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/></svg>',
            users: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>',
            phone: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>',
            play: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>'
        };

        const saved = localStorage.getItem('coachd_agency');
        if (saved) { try { currentAgency = JSON.parse(saved); showDashboard(); } catch(e) { localStorage.removeItem('coachd_agency'); } }

        async function validateAgencyCode() {
            const input = document.getElementById('agencyCode');
            const code = input.value.trim().toUpperCase();
            if (!code) { input.classList.add('error'); setTimeout(() => input.classList.remove('error'), 400); return; }
            showPageLoader();
            try {
                const res = await fetch('/api/agency/validate', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ code }) });
                const data = await res.json();
                if (res.ok && data.valid) { currentAgency = { code: data.code, name: data.name }; } else { throw new Error(); }
            } catch(e) { currentAgency = { code, name: code }; }
            localStorage.setItem('coachd_agency', JSON.stringify(currentAgency));
            showDashboard();
        }

        function showDashboard() {
            document.getElementById('codeScreen').classList.remove('active');
            document.getElementById('dashboardScreen').classList.add('active');
            const hour = new Date().getHours();
            const greeting = hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening';
            document.getElementById('greeting').textContent = `${greeting}, Agent`;
            renderSchedule();
            updateTime();
            setInterval(updateTime, 60000);
            setTimeout(hidePageLoader, 200);
        }

        function renderSchedule() {
            const hour = new Date().getHours();
            document.getElementById('scheduleList').innerHTML = schedule.map((item, i) => {
                const isActive = hour >= item.hours[0] && hour < item.hours[1];
                return `<div class="schedule-item ${isActive ? 'active' : ''}">
                    <div class="schedule-icon">${icons[item.icon]}</div>
                    <div class="schedule-content">
                        <div class="schedule-time">${item.time}</div>
                        <div class="schedule-title">${item.title}</div>
                        <div class="schedule-desc">${item.desc}</div>
                    </div>
                    ${isActive && item.icon === 'phone' ? `<button class="schedule-action" onclick="startCall()">${icons.play} Start</button>` : ''}
                </div>`;
            }).join('');
        }

        function updateTime() { document.getElementById('currentTime').textContent = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }); }
        function startCall() { sessionStorage.setItem('coachd_agency', JSON.stringify(currentAgency)); showPageLoader(); window.location.href = '/call'; }
        function goToChat(q) { sessionStorage.setItem('coachd_agency', JSON.stringify(currentAgency)); if(q) sessionStorage.setItem('coachd_chat_query', q); showPageLoader(); window.location.href = '/chat'; }
        function handleSearch() { const q = document.getElementById('searchInput').value.trim(); if(q) goToChat(q); }
        document.getElementById('searchInput').addEventListener('keypress', e => { if(e.key === 'Enter') handleSearch(); });
        document.getElementById('agencyCode').addEventListener('keypress', e => { if(e.key === 'Enter') validateAgencyCode(); });
        function showToast(msg, type='info') { const t = document.getElementById('toast'); t.textContent = msg; t.className = 'toast show' + (type === 'error' ? ' error' : ''); setTimeout(() => t.classList.remove('show'), 3000); }
        function showPageLoader() { document.getElementById('pageLoader').classList.remove('hidden'); }
        function hidePageLoader() { document.getElementById('pageLoader').classList.add('hidden'); }
        window.addEventListener('load', () => setTimeout(hidePageLoader, 200));
    </script>
</body>
</html>
