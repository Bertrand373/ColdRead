<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Coachd</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#F5F5F7">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root{--color-bg:#F5F5F7;--color-glass:rgba(255,255,255,0.65);--color-glass-strong:rgba(255,255,255,0.85);--color-glass-border:rgba(255,255,255,0.4);--color-border:rgba(0,0,0,0.06);--color-text:#1A1A1A;--color-text-secondary:#6B7280;--color-text-muted:#9CA3AF;--color-accent:#3B82F6;--color-accent-soft:rgba(59,130,246,0.12);--color-error:#EF4444;--font-display:'Outfit',sans-serif;--font-body:'Inter',sans-serif;--blur:blur(24px);--blur-strong:blur(40px);--shadow-glass:0 8px 32px rgba(0,0,0,0.06);--radius-sm:12px;--radius-md:16px;--radius-lg:24px;--radius-full:9999px;--safe-bottom:env(safe-area-inset-bottom,0px);--sidebar-width:72px}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}html,body{height:100%;overflow:hidden}body{background:var(--color-bg);color:var(--color-text);font-family:var(--font-body);-webkit-font-smoothing:antialiased}
        .screen{display:none;height:100%}.screen.active{display:flex}

        /* ===== LANDING SCREEN ===== */
        .landing-screen{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;position:relative}
        .landing-logo{margin-bottom:12px}
        .landing-tagline{font-size:1.05rem;font-weight:400;color:var(--color-text-secondary);margin-bottom:48px}
        .code-input-wrapper{margin-bottom:32px;width:100%;max-width:280px}
        .code-input{width:100%;padding:18px 24px;background:transparent;border:1.5px solid var(--color-border);border-radius:var(--radius-md);font-family:var(--font-body);font-size:1rem;font-weight:500;text-align:center;text-transform:uppercase;letter-spacing:0.15em;color:var(--color-text);transition:all 0.2s}
        .code-input::placeholder{color:var(--color-text-muted);font-weight:400;letter-spacing:0.1em}
        .code-input:focus{outline:none;border-color:var(--color-accent);box-shadow:0 0 0 3px var(--color-accent-soft)}
        .code-input.error{border-color:var(--color-error);box-shadow:0 0 0 3px rgba(239,68,68,0.1);animation:shake 0.4s}
        @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
        .btn-primary{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:16px 40px;background:var(--color-text);color:white;font-family:var(--font-display);font-size:0.95rem;font-weight:600;letter-spacing:0.01em;border:none;border-radius:var(--radius-full);cursor:pointer;transition:all 0.2s;min-height:54px;box-shadow:0 2px 8px rgba(0,0,0,0.12),0 1px 3px rgba(0,0,0,0.08)}
        .btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
        .btn-primary:disabled{opacity:0.5;cursor:not-allowed;transform:none;box-shadow:none}
        .btn-primary svg{width:18px;height:18px;opacity:0.9}
        .landing-footer{position:absolute;bottom:24px;left:0;right:0;text-align:center}
        .landing-footer-text{font-size:0.75rem;color:var(--color-text-muted);margin-bottom:8px}
        .landing-footer-links{display:flex;justify-content:center;gap:16px}
        .landing-footer-links a{font-size:0.7rem;color:var(--color-text-muted);text-decoration:none}
        .landing-footer-links a:hover{color:var(--color-text-secondary)}

        /* ===== DASHBOARD SCREEN ===== */
        .dashboard-screen{flex-direction:row;position:relative}

        /* ===== SIDEBAR (Desktop) ===== */
        .sidebar{width:var(--sidebar-width);background:var(--color-glass);backdrop-filter:var(--blur-strong);border-right:1px solid var(--color-border);display:flex;flex-direction:column;align-items:center;padding:20px 0;position:fixed;top:0;left:0;height:100vh;z-index:100}
        .sidebar-logo{width:40px;height:40px;margin-bottom:32px}
        .sidebar-logo img{width:100%;height:100%}
        .sidebar-nav{flex:1;display:flex;flex-direction:column;align-items:center;gap:8px;padding:0 12px}
        .nav-item{width:48px;height:48px;display:flex;align-items:center;justify-content:center;border:none;border-radius:var(--radius-sm);background:transparent;color:var(--color-text-muted);cursor:pointer;transition:all 0.15s;text-decoration:none;position:relative}
        .nav-item:hover{background:rgba(255,255,255,0.5);color:var(--color-text)}
        .nav-item.active{background:var(--color-accent-soft);color:var(--color-accent)}
        .nav-item svg{width:22px;height:22px}
        .nav-item::after{content:attr(data-tooltip);position:absolute;left:calc(100% + 12px);padding:8px 12px;background:var(--color-text);color:white;font-size:0.8rem;font-weight:500;border-radius:8px;white-space:nowrap;opacity:0;visibility:hidden;transition:all 0.15s;pointer-events:none}
        .nav-item:hover::after{opacity:1;visibility:visible}
        .sidebar-footer{padding:0 12px;display:flex;flex-direction:column;align-items:center;gap:8px}
        .user-avatar{width:40px;height:40px;border-radius:50%;background:var(--color-accent-soft);color:var(--color-accent);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.85rem}

        /* ===== MAIN CONTENT ===== */
        .main-content{flex:1;margin-left:var(--sidebar-width);height:100vh;overflow-y:auto;padding:32px 40px 120px}
        .dashboard{max-width:1200px;margin:0 auto}
        .page-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:32px}
        .page-title{font-family:var(--font-display);font-size:2rem;font-weight:600;letter-spacing:-0.02em;margin-bottom:4px}
        .page-subtitle{font-size:0.95rem;color:var(--color-text-secondary)}
        .day-badge{display:flex;align-items:center;gap:8px;padding:10px 18px;background:var(--color-glass-strong);backdrop-filter:var(--blur);border:1px solid var(--color-glass-border);border-radius:var(--radius-full);font-size:0.85rem;font-weight:600;color:var(--color-accent);box-shadow:var(--shadow-glass)}
        .day-badge svg{width:16px;height:16px}

        /* ===== GLASS CARDS ===== */
        .glass-card{background:var(--color-glass);backdrop-filter:var(--blur);border:1px solid var(--color-glass-border);border-radius:var(--radius-lg);box-shadow:var(--shadow-glass);overflow:hidden}
        .progress-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:28px}
        .progress-card{padding:24px}
        .progress-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .progress-label{font-size:0.9rem;font-weight:500;color:var(--color-text-secondary)}
        .progress-icon{width:36px;height:36px;border-radius:var(--radius-sm);background:rgba(255,255,255,0.5);display:flex;align-items:center;justify-content:center;color:var(--color-text-muted)}
        .progress-icon svg{width:18px;height:18px}
        .progress-value{margin-bottom:16px}
        .progress-current{font-family:var(--font-display);font-size:2.5rem;font-weight:600;line-height:1}
        .progress-total{font-size:1.25rem;color:var(--color-text-muted)}
        .progress-track{height:6px;background:var(--color-border);border-radius:3px;overflow:hidden}
        .progress-bar{height:100%;border-radius:3px;background:var(--color-accent);transition:width 0.5s}
        .content-grid{display:grid;grid-template-columns:1fr;gap:20px;margin-bottom:28px}
        .card-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--color-border)}
        .card-title{font-family:var(--font-display);font-size:1.1rem;font-weight:600}
        .time-badge{display:flex;align-items:center;gap:6px;font-size:0.8rem;color:var(--color-text-muted)}
        .time-badge svg{width:14px;height:14px}

        /* ===== SCHEDULE ===== */
        .schedule-list{padding:16px}
        .schedule-item{display:flex;align-items:center;gap:16px;padding:16px;border-radius:var(--radius-md);margin-bottom:8px}
        .schedule-item:last-child{margin-bottom:0}
        .schedule-item.active{background:var(--color-accent-soft)}
        .schedule-icon{width:48px;height:48px;min-width:48px;border-radius:var(--radius-md);background:rgba(255,255,255,0.5);display:flex;align-items:center;justify-content:center;color:var(--color-text-muted)}
        .schedule-icon svg{width:22px;height:22px}
        .schedule-item.active .schedule-icon{background:var(--color-accent);color:white}
        .schedule-content{flex:1}
        .schedule-time{font-size:0.7rem;font-weight:600;color:var(--color-text-muted);text-transform:uppercase;letter-spacing:0.04em}
        .schedule-title{font-family:var(--font-display);font-size:1rem;font-weight:600}
        .schedule-item.active .schedule-title{color:var(--color-accent)}
        .schedule-desc{font-size:0.85rem;color:var(--color-text-secondary)}
        .schedule-action{padding:10px 18px;background:var(--color-accent);color:white;border:none;border-radius:var(--radius-full);font-size:0.85rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px}
        .schedule-action:hover{background:#2563EB}
        .schedule-action svg{width:16px;height:16px}

        /* ===== QUICK ACCESS ===== */
        /* ===== CHAT MODAL ===== */
        .chat-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);backdrop-filter:blur(4px);z-index:1000;opacity:0;visibility:hidden;transition:all 0.3s}
        .chat-overlay.open{opacity:1;visibility:visible}
        .chat-modal{position:fixed;bottom:0;right:0;width:420px;height:85vh;max-height:700px;background:var(--color-glass-strong);backdrop-filter:var(--blur-strong);border:1px solid var(--color-glass-border);border-radius:var(--radius-lg) var(--radius-lg) 0 0;box-shadow:0 -8px 40px rgba(0,0,0,0.15);z-index:1001;display:flex;flex-direction:column;transform:translateY(100%);transition:transform 0.3s cubic-bezier(0.32,0.72,0,1)}
        .chat-overlay.open .chat-modal{transform:translateY(0)}
        .chat-modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--color-border)}
        .chat-modal-logo{height:22px;opacity:0.85}
        .chat-modal-close{width:32px;height:32px;border:none;border-radius:var(--radius-full);background:transparent;color:var(--color-text-muted);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.15s}
        .chat-modal-close:hover{background:rgba(0,0,0,0.05);color:var(--color-text)}
        .chat-modal-close svg{width:20px;height:20px}
        .chat-modal-body{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column}
        .chat-modal-body::-webkit-scrollbar{width:4px}
        .chat-modal-body::-webkit-scrollbar-thumb{background:var(--color-border);border-radius:2px}
        .chat-empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px}
        .chat-empty-icon{width:48px;height:48px;background:var(--color-accent-soft);border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;margin-bottom:16px}
        .chat-empty-icon svg{width:24px;height:24px;color:var(--color-accent)}
        .chat-empty-title{font-family:var(--font-display);font-size:1.1rem;font-weight:600;margin-bottom:6px}
        .chat-empty-text{font-size:0.85rem;color:var(--color-text-muted);max-width:260px;line-height:1.5;margin-bottom:20px}
        .chat-empty-suggestions{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
        .chat-suggestion{padding:8px 14px;background:rgba(255,255,255,0.6);border:1px solid var(--color-border);border-radius:var(--radius-full);font-size:0.8rem;font-weight:500;color:var(--color-text-secondary);cursor:pointer}
        .chat-suggestion:hover{border-color:var(--color-accent);color:var(--color-accent)}
        .chat-messages{display:flex;flex-direction:column;gap:16px}
        .chat-message{max-width:85%;animation:msgIn 0.2s}
        @keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .chat-message.user{align-self:flex-end}
        .chat-message.user .msg-bubble{background:var(--color-text);color:white;border-radius:18px 18px 4px 18px;padding:12px 16px;font-size:0.9rem;line-height:1.5}
        .chat-message.ai{align-self:flex-start}
        .chat-message.ai .msg-label{font-size:0.7rem;font-weight:600;color:var(--color-text-muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.03em}
        .chat-message.ai .msg-bubble{font-size:0.9rem;line-height:1.6}
        .chat-message.ai .msg-bubble strong{font-weight:600}
        .typing-indicator{display:flex;gap:4px;padding:12px 0}
        .typing-dot{width:6px;height:6px;border-radius:50%;background:var(--color-accent);animation:bounce 1.4s ease-in-out infinite}
        .typing-dot:nth-child(2){animation-delay:0.2s}
        .typing-dot:nth-child(3){animation-delay:0.4s}
        @keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-4px)}}
        .chat-modal-footer{padding:16px 20px;border-top:1px solid var(--color-border)}
        .chat-input-wrap{display:flex;align-items:flex-end;gap:10px;padding:8px 8px 8px 16px;background:transparent;border:1.5px solid var(--color-border);border-radius:var(--radius-md);transition:all 0.2s}
        .chat-input-wrap:focus-within{border-color:var(--color-accent);box-shadow:0 0 0 3px var(--color-accent-soft)}
        .chat-input{flex:1;border:none;background:transparent;font-family:var(--font-body);font-size:0.9rem;color:var(--color-text);resize:none;outline:none;min-height:24px;max-height:100px;padding:6px 0}
        .chat-input::placeholder{color:var(--color-text-muted)}
        .chat-send{width:36px;height:36px;border:none;border-radius:var(--radius-full);background:var(--color-text);color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.15s}
        .chat-send:hover{transform:scale(1.05)}
        .chat-send:disabled{opacity:0.4;cursor:not-allowed;transform:none}
        .chat-send svg{width:16px;height:16px}

        /* ===== FLOATING GLASS PILL NAV (Mobile) ===== */
        .bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;z-index:400;padding:8px 12px calc(8px + var(--safe-bottom))}
        .bottom-nav-pill{background:var(--color-glass-strong);backdrop-filter:var(--blur-strong);border:1px solid var(--color-glass-border);border-radius:var(--radius-full);padding:6px 8px;box-shadow:0 4px 24px rgba(0,0,0,0.1)}
        .bottom-nav-items{display:flex;justify-content:space-around}
        .bottom-nav-item{display:flex;flex-direction:column;align-items:center;gap:3px;padding:8px 12px;background:transparent;border:none;color:var(--color-text-muted);text-decoration:none;border-radius:var(--radius-md);transition:color 0.15s}
        .bottom-nav-item.active{color:var(--color-accent)}
        .bottom-nav-item svg{width:20px;height:20px}
        .bottom-nav-label{font-size:0.6rem;font-weight:600}

        /* ===== TOAST ===== */
        .toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(100px);padding:14px 28px;background:var(--color-text);color:white;border-radius:var(--radius-full);font-size:0.9rem;font-weight:500;opacity:0;transition:all 0.3s;z-index:2000}
        .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
        .toast.error{background:var(--color-error)}

        /* ===== MOBILE BRANDED HEADER ===== */
        .mobile-header{display:none;position:fixed;top:0;left:0;right:0;height:44px;padding:0 20px;z-index:300;align-items:center;justify-content:space-between;background:transparent}
        .mobile-header-left{display:flex;align-items:center;gap:8px}
        .mobile-header-logo{width:24px;height:24px;display:flex;align-items:center;justify-content:center}
        .mobile-header-logo img{width:100%;height:100%;object-fit:contain}
        .mobile-header-wordmark{font-size:0.75rem;font-weight:600;color:var(--color-text);letter-spacing:0.1em;text-transform:uppercase}

        /* ===== RESPONSIVE ===== */
        @media(max-width:1024px){.progress-grid{grid-template-columns:repeat(2,1fr)}.content-grid{grid-template-columns:1fr}}
        @media(max-width:768px){
            .sidebar{display:none}
            .mobile-header{display:flex}
            .bottom-nav{display:block}
            .main-content{margin-left:0;padding:calc(44px + 24px) 20px calc(100px + var(--safe-bottom))}
            .page-header{flex-direction:column;gap:16px}
            .page-title{font-size:1.6rem}
            .progress-grid{grid-template-columns:1fr;gap:16px}
            .chat-modal{width:100%;height:90vh;max-height:none;border-radius:var(--radius-lg) var(--radius-lg) 0 0}
        }
        @media(orientation:landscape) and (max-height:500px){.dashboard-screen{display:none!important}}
    </style>
</head>
<body>
    <!-- LANDING SCREEN (completely isolated - no nav, no FAB) -->
    <div class="screen active" id="landingScreen">
        <div class="landing-screen">
            <img src="/static/logo.png" alt="Coachd" height="52" class="landing-logo">
            <p class="landing-tagline">Coaching on call.</p>
            <div class="code-input-wrapper">
                <input type="text" class="code-input" id="agencyCode" placeholder="AGENCY CODE" autocomplete="off" autocapitalize="characters">
            </div>
            <button class="btn-primary" id="continueBtn" onclick="validateAgencyCode()">Continue <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
            <footer class="landing-footer">
                <p class="landing-footer-text">© 2026 Coachd</p>
                <div class="landing-footer-links"><a href="/terms">Terms</a><a href="/privacy">Privacy</a></div>
            </footer>
        </div>
    </div>

    <!-- DASHBOARD SCREEN (contains all nav elements) -->
    <div class="screen dashboard-screen" id="dashboardScreen">
        <!-- Mobile Branded Header -->
        <header class="mobile-header">
            <div class="mobile-header-left">
                <div class="mobile-header-logo">
                    <img src="/static/favicon.svg" alt="Coachd">
                </div>
                <span class="mobile-header-wordmark">Coachd</span>
            </div>
        </header>
        <aside class="sidebar">
            <div class="sidebar-logo"><img src="/static/favicon.svg" alt=""></div>
            <nav class="sidebar-nav">
                <a href="/" class="nav-item active" data-tooltip="Dashboard"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></a>
                <a href="/call" class="nav-item" data-tooltip="Live Call"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></a>
                <a href="#" class="nav-item" data-tooltip="Resources"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg></a>
                <button class="nav-item" data-tooltip="Ask" onclick="openChat()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></button>
            </nav>
            <div class="sidebar-footer">
                <a href="#" class="nav-item" data-tooltip="Settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg></a>
                <div class="user-avatar">A</div>
            </div>
        </aside>
        <main class="main-content">
            <div class="dashboard">
                <header class="page-header"><div><h1 class="page-title" id="greeting">Good morning, Agent</h1><p class="page-subtitle">Week 1 · Focus on training & observation</p></div><div class="day-badge"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg><span id="dayBadge">Day 4 of 14</span></div></header>
                <section class="progress-grid">
                    <div class="glass-card progress-card"><div class="progress-card-header"><span class="progress-label">Modules</span><div class="progress-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg></div></div><div class="progress-value"><span class="progress-current">3</span><span class="progress-total">/5</span></div><div class="progress-track"><div class="progress-bar" style="width:60%"></div></div></div>
                    <div class="glass-card progress-card"><div class="progress-card-header"><span class="progress-label">Calls Today</span><div class="progress-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></div></div><div class="progress-value"><span class="progress-current">8</span><span class="progress-total">/15</span></div><div class="progress-track"><div class="progress-bar" style="width:53%"></div></div></div>
                    <div class="glass-card progress-card"><div class="progress-card-header"><span class="progress-label">Appointments</span><div class="progress-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div></div><div class="progress-value"><span class="progress-current">1</span><span class="progress-total">/3</span></div><div class="progress-track"><div class="progress-bar" style="width:33%"></div></div></div>
                </section>
                <div class="content-grid">
                    <section class="glass-card"><div class="card-header"><h2 class="card-title">Today's Schedule</h2><div class="time-badge"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg><span id="currentTime">--:--</span></div></div><div class="schedule-list" id="scheduleList"></div></section>
                </div>
            </div>
        </main>
        <nav class="bottom-nav"><div class="bottom-nav-pill"><div class="bottom-nav-items">
            <a href="/" class="bottom-nav-item active"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg><span class="bottom-nav-label">Home</span></a>
            <a href="/call" class="bottom-nav-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg><span class="bottom-nav-label">Call</span></a>
            <button class="bottom-nav-item" onclick="openChat()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg><span class="bottom-nav-label">Ask</span></button>
            <a href="#" class="bottom-nav-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg><span class="bottom-nav-label">Resources</span></a>
            <a href="#" class="bottom-nav-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg><span class="bottom-nav-label">Settings</span></a>
        </div></div></nav>
    </div>

    <!-- CHAT MODAL (global overlay) -->
    <div class="chat-overlay" id="chatOverlay" onclick="closeChatIfBackdrop(event)">
        <div class="chat-modal" onclick="event.stopPropagation()">
            <div class="chat-modal-header"><img src="/static/logo.png" alt="Coachd" class="chat-modal-logo"><button class="chat-modal-close" onclick="closeChat()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
            <div class="chat-modal-body" id="chatBody">
                <div class="chat-empty" id="chatEmpty"><div class="chat-empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></div><h3 class="chat-empty-title">How can I help?</h3><p class="chat-empty-text">Ask about objections, scripts, products, or get advice for specific situations.</p><div class="chat-empty-suggestions"><button class="chat-suggestion" onclick="useSuggestion('Client says they cannot afford it')">Can't afford it</button><button class="chat-suggestion" onclick="useSuggestion('Down-close sequence')">Down-close</button><button class="chat-suggestion" onclick="useSuggestion('How to handle think about it')">Think about it</button></div></div>
                <div class="chat-messages" id="chatMessages"></div>
            </div>
            <div class="chat-modal-footer"><div class="chat-input-wrap"><textarea class="chat-input" id="chatInput" placeholder="Ask anything..." rows="1"></textarea><button class="chat-send" id="chatSend" onclick="sendMessage()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button></div></div>
        </div>
    </div>
    <div class="toast" id="toast"></div>

    <script>
        let currentAgency=null,chatMessages=[],isWaiting=false;
        const schedule=[{time:'11 AM – 1 PM',title:'Training Block',desc:'Complete TopNotch Module 4',icon:'book',hours:[11,13]},{time:'1 – 3 PM',title:'Lunch / Flex',desc:'Break or ExamFX study',icon:'coffee',hours:[13,15]},{time:'3 – 4 PM',title:'Observation',desc:'Join Advanced Training VC',icon:'users',hours:[15,16]},{time:'4 – 7 PM',title:'Calling Block',desc:'Goal: 15 dials, 3 appointments',icon:'phone',hours:[16,19]}];
        const icons={book:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>',coffee:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8h1a4 4 0 010 8h-1"/><path d="M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/></svg>',users:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>',phone:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>',play:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>'};
        const saved=localStorage.getItem('coachd_agency');if(saved){try{currentAgency=JSON.parse(saved);showDashboard()}catch(e){localStorage.removeItem('coachd_agency')}}
        async function validateAgencyCode(){const input=document.getElementById('agencyCode'),btn=document.getElementById('continueBtn'),code=input.value.trim().toUpperCase();input.classList.remove('error');if(!code){input.classList.add('error');return}btn.disabled=true;try{const res=await fetch('/api/agency/validate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code})});const data=await res.json();if(res.ok&&data.valid){currentAgency={code:data.code,name:data.name}}else{throw new Error()}}catch(e){currentAgency={code,name:code}}localStorage.setItem('coachd_agency',JSON.stringify(currentAgency));showDashboard()}
        function showDashboard(){document.getElementById('landingScreen').classList.remove('active');document.getElementById('dashboardScreen').classList.add('active');const hour=new Date().getHours();document.getElementById('greeting').textContent=`${hour<12?'Good morning':hour<17?'Good afternoon':'Good evening'}, Agent`;renderSchedule();updateTime();setInterval(updateTime,60000);if(new URLSearchParams(window.location.search).get('chat')==='open'){setTimeout(()=>openChat(),100);history.replaceState(null,'',window.location.pathname)}}
        function renderSchedule(){const hour=new Date().getHours();document.getElementById('scheduleList').innerHTML=schedule.map((item)=>{const isActive=hour>=item.hours[0]&&hour<item.hours[1];return`<div class="schedule-item ${isActive?'active':''}"><div class="schedule-icon">${icons[item.icon]}</div><div class="schedule-content"><div class="schedule-time">${item.time}</div><div class="schedule-title">${item.title}</div><div class="schedule-desc">${item.desc}</div></div>${isActive&&item.icon==='phone'?`<button class="schedule-action" onclick="startCall()">${icons.play} Start</button>`:''}</div>`}).join('')}
        function updateTime(){document.getElementById('currentTime').textContent=new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'})}
        function startCall(){sessionStorage.setItem('coachd_agency',JSON.stringify(currentAgency));window.location.href='/call'}
        function openChat(){document.getElementById('chatOverlay').classList.add('open');document.getElementById('chatInput').focus()}
        function closeChat(){document.getElementById('chatOverlay').classList.remove('open')}
        function closeChatIfBackdrop(e){if(e.target===e.currentTarget)closeChat()}
        function openChatWith(q){openChat();if(q){document.getElementById('chatInput').value=q;setTimeout(()=>sendMessage(),100)}}
        function useSuggestion(t){document.getElementById('chatInput').value=t;sendMessage()}
        const chatInput=document.getElementById('chatInput');chatInput.addEventListener('input',()=>{chatInput.style.height='auto';chatInput.style.height=Math.min(chatInput.scrollHeight,100)+'px'});chatInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}});
        async function sendMessage(){const text=chatInput.value.trim();if(!text||isWaiting)return;document.getElementById('chatEmpty').style.display='none';const messagesEl=document.getElementById('chatMessages');addMessage('user',text);chatInput.value='';chatInput.style.height='auto';isWaiting=true;document.getElementById('chatSend').disabled=true;const typingEl=document.createElement('div');typingEl.className='chat-message ai';typingEl.innerHTML='<div class="msg-label">Coachd</div><div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';messagesEl.appendChild(typingEl);scrollChat();try{const res=await fetch('/api/chat/stream',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:text,agency:currentAgency?.code,history:chatMessages.slice(-10)})});typingEl.remove();if(!res.ok)throw new Error();const reader=res.body.getReader(),decoder=new TextDecoder();let buffer='',fullText='';const aiMsgEl=document.createElement('div');aiMsgEl.className='chat-message ai';aiMsgEl.innerHTML='<div class="msg-label">Coachd</div><div class="msg-bubble"></div>';messagesEl.appendChild(aiMsgEl);const bubbleEl=aiMsgEl.querySelector('.msg-bubble');while(true){const{done,value}=await reader.read();if(done)break;buffer+=decoder.decode(value,{stream:true});const parts=buffer.split('\n\n');buffer=parts.pop()||'';for(const part of parts){for(const line of part.split('\n')){if(line.startsWith('data: ')){const data=line.slice(6);if(data==='[DONE]')continue;try{const parsed=JSON.parse(data);const chunk=parsed.text||parsed.content;if(chunk){fullText+=chunk;bubbleEl.innerHTML=formatMsg(fullText);scrollChat()}}catch(e){if(data.trim()&&data!=='[DONE]'){fullText+=data;bubbleEl.innerHTML=formatMsg(fullText);scrollChat()}}}}}}bubbleEl.innerHTML=formatMsg(fullText);chatMessages.push({role:'assistant',content:fullText})}catch(e){typingEl.remove();addMessage('ai','Sorry, something went wrong. Please try again.')}isWaiting=false;document.getElementById('chatSend').disabled=false}
        function addMessage(role,content){const messagesEl=document.getElementById('chatMessages');const msgEl=document.createElement('div');msgEl.className=`chat-message ${role}`;if(role==='user'){msgEl.innerHTML=`<div class="msg-bubble">${escapeHtml(content)}</div>`}else{msgEl.innerHTML=`<div class="msg-label">Coachd</div><div class="msg-bubble">${formatMsg(content)}</div>`}messagesEl.appendChild(msgEl);chatMessages.push({role:role==='ai'?'assistant':role,content});scrollChat()}
        function formatMsg(t){return t.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>')}
        function escapeHtml(t){return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
        function scrollChat(){const body=document.getElementById('chatBody');body.scrollTop=body.scrollHeight}
        function showToast(msg,type='info'){const t=document.getElementById('toast');t.textContent=msg;t.className='toast show'+(type==='error'?' error':'');setTimeout(()=>t.classList.remove('show'),3000)}
        document.getElementById('agencyCode').addEventListener('keypress',e=>{if(e.key==='Enter')validateAgencyCode()});
    </script>
</body>
</html>
